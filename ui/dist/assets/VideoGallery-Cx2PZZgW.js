import{_ as f,c as n,a as w,b as t,k as m,F as v,e as h,n as k,t as a,p as y,q as p,v as g,s as _,A as u,l as V,m as F,u as C,f as d}from"./index-B24G-8VQ.js";const S={name:"VideoGallery",setup(){return{toast:C()}},data(){return{authStore:F,API_BASE_URL:u,activeCategory:"all",showUploadForm:!1,selectedVideo:null,newVideo:{title:"",description:"",categoryId:"",duration:""},selectedVideoFile:null,selectedThumbnail:null,thumbnailPreview:null,categories:[{id:"all",name:"ì „ì²´",count:0},{id:"cruise-education",name:"í¬ë£¨ì¦ˆ ìš”íŠ¸ êµìœ¡",count:0},{id:"cruise-experience",name:"í¬ë£¨ì¦ˆ ìš”íŠ¸ ì²´í—˜",count:0},{id:"dinghy-education",name:"ë”©ê¸° ìš”íŠ¸ êµìœ¡",count:0},{id:"dinghy-experience",name:"ë”©ê¸° ìš”íŠ¸ ì²´í—˜",count:0},{id:"paddleboard",name:"íŒ¨ë“¤ë³´ë“œ ì²´í—˜",count:0}],videos:[]}},computed:{filteredVideos(){return this.activeCategory==="all"?this.videos:this.videos.filter(o=>o.categoryId===this.activeCategory)},isAdmin(){return this.authStore.state.isAuthenticated&&this.authStore.isAdmin()}},methods:{setActiveCategory(o){this.activeCategory=o},getCategoryName(o){const e=this.categories.find(r=>r.id===o);return e?e.name:""},playVideo(o){this.selectedVideo=o,this.incrementViews(o.id)},closeModal(){this.selectedVideo=null},async incrementViews(o){try{await V.get(`${u}/api/videos/${o}`)}catch(e){console.error("Failed to increment views:",e)}},async loadVideos(){try{console.log("Loading videos from:",`${u}/api/videos`);const o=await V.get(`${u}/api/videos`);console.log("Videos response:",o.data),this.videos=(o.data||[]).map(e=>({id:e.id,title:e.title,description:e.description,categoryId:e.category_id,date:e.created_at?e.created_at.split("T")[0]:new Date().toISOString().split("T")[0],duration:e.duration||"0:00",views:e.views||0,url:e.url,thumbnail_url:e.thumbnail_url,filename:e.filename,author:e.author_name||"ê´€ë¦¬ì"})),this.updateCategoryCounts(),console.log("Videos loaded:",this.videos.length)}catch(o){console.error("Failed to load videos:",o),this.videos=[],this.updateCategoryCounts(),console.warn("API server may not be running. Videos will be empty.")}},updateCategoryCounts(){this.categories.forEach(o=>{o.id==="all"?o.count=this.videos.length:o.count=this.videos.filter(e=>e.categoryId===o.id).length})},handleVideoSelection(o){const e=o.target.files[0];e&&(this.selectedVideoFile=e,console.log("Video selected:",e.name,e.size,e.type))},handleThumbnailSelection(o){const e=o.target.files[0];if(e){this.selectedThumbnail=e;const r=new FileReader;r.onload=c=>{this.thumbnailPreview=c.target.result},r.readAsDataURL(e),console.log("Thumbnail selected:",e.name,e.size,e.type)}},removeVideoFile(){this.selectedVideoFile=null,this.selectedThumbnail=null,this.thumbnailPreview=null,this.$refs.videoFileInput.value="",this.$refs.thumbnailFileInput.value=""},formatFileSize(o){if(o===0)return"0 Bytes";const e=1024,r=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,c)).toFixed(2))+" "+r[c]},async uploadVideo(){if(!this.selectedVideoFile){this.toast.warning("ë™ì˜ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.","ğŸ¥ ë™ì˜ìƒ ì„ íƒ í•„ìš”");return}if(!this.newVideo.title||!this.newVideo.categoryId){this.toast.warning("ì œëª©ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.","âœï¸ ì •ë³´ ì…ë ¥ í•„ìš”");return}try{console.log("Starting video upload..."),console.log("Selected video:",this.selectedVideoFile.name,this.selectedVideoFile.size),console.log("Form data:",this.newVideo);const o=new FormData;o.append("title",this.newVideo.title),o.append("description",this.newVideo.description),o.append("category_id",this.newVideo.categoryId),o.append("duration",this.newVideo.duration),o.append("video",this.selectedVideoFile),this.selectedThumbnail&&o.append("thumbnail",this.selectedThumbnail);const e=localStorage.getItem("token");console.log("Token exists:",!!e),console.log("Upload URL:",`${u}/api/videos`),this.toast.info("ë™ì˜ìƒ ì—…ë¡œë“œ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.","â³ ì—…ë¡œë“œ ì§„í–‰ì¤‘");const r=await V.post(`${u}/api/videos`,o,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});console.log("Upload response:",r.data),await this.loadVideos(),this.toast.celebrate("ë™ì˜ìƒì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.","ğŸ¥ ë™ì˜ìƒ ì—…ë¡œë“œ ì™„ë£Œ"),this.showUploadForm=!1,this.newVideo={title:"",description:"",categoryId:"",duration:""},this.selectedVideoFile=null,this.selectedThumbnail=null,this.thumbnailPreview=null,this.$refs.videoFileInput.value="",this.$refs.thumbnailFileInput.value=""}catch(o){console.error("Upload error details:",o),console.error("Error response:",o.response?.data),console.error("Error status:",o.response?.status);let e="ë™ì˜ìƒ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";o.response?.status===401?e="ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.":o.response?.status===403?e="ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.":o.response?.status===413?e="íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤.":o.response?.data?.error&&(e=o.response.data.error),this.toast.error(e,"âŒ ì—…ë¡œë“œ ì‹¤íŒ¨")}},manageVideos(){console.log("Manage videos")},goBack(){this.$router.push("/community")},onVideoError(o){console.error("Video playback error:",o),this.toast.error("ë™ì˜ìƒ ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.","âŒ ì¬ìƒ ì˜¤ë¥˜")}},mounted(){this.loadVideos(),document.addEventListener("keydown",o=>{o.key==="Escape"&&this.selectedVideo&&this.closeModal()})}},I={class:"video-gallery"},M={class:"content-section"},A={class:"container"},U={class:"gallery-categories"},B={class:"category-tabs"},T=["onClick"],E={class:"video-grid"},x=["onClick"],P={class:"video-container"},z={class:"video-thumbnail"},L=["src","alt"],D={key:1,class:"thumbnail-placeholder"},N={class:"duration-badge"},R={class:"video-info"},G={class:"video-meta"},q={class:"date"},H={class:"views"},O={class:"category"},K={key:0,class:"empty-state"},j={key:1,class:"admin-section"},J={class:"admin-buttons"},Q={key:2,class:"upload-form"},W={class:"form-header"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},$=["value"],ee={class:"form-group"},te={class:"form-group"},se={class:"form-group"},oe={key:0,class:"selected-video"},ie={class:"video-item"},le={class:"video-preview"},ne=["src"],de={key:1,class:"no-preview"},ae={class:"video-info"},re={class:"video-name"},ue={class:"video-size"},ce={class:"form-actions"},me={class:"modal-header"},pe={class:"video-player"},ve=["src"],he={key:1,class:"player-placeholder"},ge={class:"modal-info"},Ve={class:"modal-meta"},ye={class:"back-button"};function be(o,e,r,c,i,l){return d(),n("div",I,[e[37]||(e[37]=w('<section class="hero-section" data-v-dc888a10><div class="hero-background" data-v-dc888a10></div><div class="hero-overlay" data-v-dc888a10></div><div class="hero-content" data-v-dc888a10><h1 class="hero-title" data-v-dc888a10>ë™ì˜ìƒê°¤ëŸ¬ë¦¬</h1><p class="hero-subtitle" data-v-dc888a10>í†µì˜ìš”íŠ¸í•™êµì˜ ìƒìƒí•œ ì˜ìƒìœ¼ë¡œ í˜„ì¥ê°ì„ ëŠê»´ë³´ì„¸ìš”</p></div></section>',1)),t("section",M,[t("div",A,[e[36]||(e[36]=t("div",{class:"gallery-header"},[t("div",{class:"header-info"},[t("h2",null,"ë™ì˜ìƒ ê°¤ëŸ¬ë¦¬"),t("p",null,"ê´€ë¦¬ì ì „ìš© ê³µê°„ì…ë‹ˆë‹¤. ìš”íŠ¸ êµìœ¡ê³¼ ì²´í—˜ í™œë™ì˜ ì˜ìƒì„ ì‹œì²­í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")]),t("div",{class:"admin-notice"},[t("div",{class:"notice-icon"},"ğŸ”’"),t("span",null,"ê´€ë¦¬ì ì „ìš©")])],-1)),t("div",U,[t("div",B,[(d(!0),n(v,null,h(i.categories,s=>(d(),n("button",{key:s.id,class:k(["tab-button",{active:i.activeCategory===s.id}]),onClick:b=>l.setActiveCategory(s.id)},a(s.name)+" ("+a(s.count)+") ",11,T))),128))])]),t("div",E,[(d(!0),n(v,null,h(l.filteredVideos,s=>(d(),n("div",{key:s.id,class:"video-card",onClick:b=>l.playVideo(s)},[t("div",P,[t("div",z,[s.thumbnail_url?(d(),n("img",{key:0,src:`${i.API_BASE_URL}${s.thumbnail_url}`,alt:s.title,class:"thumbnail-image"},null,8,L)):(d(),n("div",D,e[17]||(e[17]=[t("div",{class:"play-icon"},"â–¶",-1)]))),e[18]||(e[18]=t("div",{class:"play-overlay"},[t("div",{class:"play-icon"},"â–¶")],-1)),t("div",N,a(s.duration),1)])]),t("div",R,[t("h4",null,a(s.title),1),t("p",null,a(s.description),1),t("div",G,[t("span",q,a(s.date),1),t("span",H,"ì¡°íšŒìˆ˜ "+a(s.views)+"íšŒ",1),t("span",O,a(l.getCategoryName(s.categoryId)),1)])])],8,x))),128))]),l.filteredVideos.length===0?(d(),n("div",K,e[19]||(e[19]=[t("div",{class:"empty-icon"},"ğŸ¥",-1),t("h3",null,"ì•„ì§ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤",-1),t("p",null,"ê´€ë¦¬ìê°€ ê³§ í¥ë¯¸ë¡œìš´ ì˜ìƒë“¤ì„ ì—…ë¡œë“œí•  ì˜ˆì •ì…ë‹ˆë‹¤.",-1)]))):m("",!0),l.isAdmin?(d(),n("div",j,[e[20]||(e[20]=t("h3",null,"ê´€ë¦¬ì ê¸°ëŠ¥",-1)),t("div",J,[t("button",{class:"admin-btn upload-btn",onClick:e[0]||(e[0]=s=>i.showUploadForm=!0)}," ğŸ¥ ë™ì˜ìƒ ì—…ë¡œë“œ "),t("button",{class:"admin-btn manage-btn",onClick:e[1]||(e[1]=(...s)=>l.manageVideos&&l.manageVideos(...s))}," ğŸ—‚ï¸ ë™ì˜ìƒ ê´€ë¦¬ ")])])):m("",!0),i.showUploadForm&&l.isAdmin?(d(),n("div",Q,[t("div",W,[e[21]||(e[21]=t("h3",null,"ë™ì˜ìƒ ì—…ë¡œë“œ",-1)),t("button",{class:"close-btn",onClick:e[2]||(e[2]=s=>i.showUploadForm=!1)},"âœ•")]),t("form",{onSubmit:e[11]||(e[11]=y((...s)=>l.uploadVideo&&l.uploadVideo(...s),["prevent"]))},[t("div",X,[e[22]||(e[22]=t("label",null,"ì œëª©",-1)),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>i.newVideo.title=s),type:"text",required:""},null,512),[[g,i.newVideo.title]])]),t("div",Y,[e[23]||(e[23]=t("label",null,"ì„¤ëª…",-1)),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>i.newVideo.description=s),rows:"3"},null,512),[[g,i.newVideo.description]])]),t("div",Z,[e[25]||(e[25]=t("label",null,"ì¹´í…Œê³ ë¦¬",-1)),p(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>i.newVideo.categoryId=s),required:""},[e[24]||(e[24]=t("option",{value:""},"ì¹´í…Œê³ ë¦¬ ì„ íƒ",-1)),(d(!0),n(v,null,h(i.categories.filter(s=>s.id!=="all"),s=>(d(),n("option",{key:s.id,value:s.id},a(s.name),9,$))),128))],512),[[_,i.newVideo.categoryId]])]),t("div",ee,[e[26]||(e[26]=t("label",null,"ì¬ìƒ ì‹œê°„ (ì„ íƒì‚¬í•­)",-1)),p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>i.newVideo.duration=s),type:"text",placeholder:"ì˜ˆ: 5:30"},null,512),[[g,i.newVideo.duration]]),e[27]||(e[27]=t("small",null,"í˜•ì‹: MM:SS ë˜ëŠ” HH:MM:SS",-1))]),t("div",te,[e[28]||(e[28]=t("label",null,"ë™ì˜ìƒ íŒŒì¼",-1)),t("input",{type:"file",accept:"video/*",onChange:e[7]||(e[7]=(...s)=>l.handleVideoSelection&&l.handleVideoSelection(...s)),ref:"videoFileInput"},null,544),e[29]||(e[29]=t("small",null,"ì§€ì› í˜•ì‹: MP4, AVI, MOV (ìµœëŒ€ 1GB)",-1))]),t("div",se,[e[30]||(e[30]=t("label",null,"ì¸ë„¤ì¼ ì´ë¯¸ì§€",-1)),t("input",{type:"file",accept:"image/*",onChange:e[8]||(e[8]=(...s)=>l.handleThumbnailSelection&&l.handleThumbnailSelection(...s)),ref:"thumbnailFileInput"},null,544),e[31]||(e[31]=t("small",null,"ë™ì˜ìƒ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)",-1))]),i.selectedVideoFile?(d(),n("div",oe,[e[32]||(e[32]=t("h4",null,"ì„ íƒëœ ë™ì˜ìƒ:",-1)),t("div",ie,[t("div",le,[i.thumbnailPreview?(d(),n("img",{key:0,src:i.thumbnailPreview,alt:"ì¸ë„¤ì¼"},null,8,ne)):(d(),n("div",de,"ğŸ¥"))]),t("div",ae,[t("span",re,a(i.selectedVideoFile.name),1),t("span",ue,a(l.formatFileSize(i.selectedVideoFile.size)),1)]),t("button",{type:"button",onClick:e[9]||(e[9]=(...s)=>l.removeVideoFile&&l.removeVideoFile(...s)),class:"remove-file"},"âœ•")])])):m("",!0),t("div",ce,[t("button",{type:"button",class:"cancel-btn",onClick:e[10]||(e[10]=s=>i.showUploadForm=!1)}," ì·¨ì†Œ "),e[33]||(e[33]=t("button",{type:"submit",class:"upload-btn"},"ì—…ë¡œë“œ",-1))])],32)])):m("",!0),i.selectedVideo?(d(),n("div",{key:3,class:"video-modal",onClick:e[15]||(e[15]=(...s)=>l.closeModal&&l.closeModal(...s))},[t("div",{class:"modal-content",onClick:e[14]||(e[14]=y(()=>{},["stop"]))},[t("div",me,[t("h3",null,a(i.selectedVideo.title),1),t("button",{class:"close-btn",onClick:e[12]||(e[12]=(...s)=>l.closeModal&&l.closeModal(...s))},"âœ•")]),t("div",pe,[i.selectedVideo.url?(d(),n("video",{key:0,src:`${i.API_BASE_URL}${i.selectedVideo.url}`,controls:"",autoplay:"",class:"video-element",onError:e[13]||(e[13]=(...s)=>l.onVideoError&&l.onVideoError(...s))}," ë¸Œë¼ìš°ì €ê°€ ë™ì˜ìƒ ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ",40,ve)):(d(),n("div",he,[e[34]||(e[34]=t("div",{class:"play-icon large"},"â–¶",-1)),t("p",null,a(i.selectedVideo.title),1),e[35]||(e[35]=t("small",null,"ë™ì˜ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",-1))]))]),t("div",ge,[t("p",null,a(i.selectedVideo.description),1),t("div",Ve,[t("span",null,"ì—…ë¡œë“œ: "+a(i.selectedVideo.date),1),t("span",null,"ì¡°íšŒìˆ˜: "+a(i.selectedVideo.views)+"íšŒ",1),t("span",null,"ì¹´í…Œê³ ë¦¬: "+a(l.getCategoryName(i.selectedVideo.categoryId)),1)])])])])):m("",!0)])]),t("div",ye,[t("button",{onClick:e[16]||(e[16]=(...s)=>l.goBack&&l.goBack(...s)),class:"back-btn"}," â† ì»¤ë®¤ë‹ˆí‹°ë¡œ ëŒì•„ê°€ê¸° ")])])}const we=f(S,[["render",be],["__scopeId","data-v-dc888a10"]]);export{we as default};
