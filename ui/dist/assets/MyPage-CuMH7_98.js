import{_ as h,c as n,b as e,t as o,n as c,g as p,w as m,h as f,i as _,F as g,e as y,x as b,A as v,s as k,u as L,f as i}from"./index-fXz6EMut.js";const S={name:"MyPage",setup(){return{toast:L()}},data(){return{authStore:k,isLoading:!1,applications:[]}},computed:{user(){return this.authStore.state.user}},async mounted(){!this.authStore.state.isAuthenticated&&localStorage.getItem("token")&&this.authStore.init(),this.authStore.state.isAuthenticated&&await this.loadApplications()},methods:{getRoleName(s){return{admin:"관리자",user:"일반 사용자"}[s]||"사용자"},async refreshProfile(){this.isLoading=!0;try{await this.authStore.fetchUser()}catch{this.toast.error("프로필 새로고침에 실패했습니다.","⚠️ 프로필 오류")}finally{this.isLoading=!1}},async loadApplications(){try{const s=localStorage.getItem("token");if(!s)return;const t=await b.get(`${v}/api/applications/my-exemption`,{headers:{Authorization:`Bearer ${s}`}});this.applications=t.data}catch(s){console.error("Failed to load applications:",s)}},getStatusLabel(s){return{pending:"승인대기",approved:"승인완료",rejected:"승인거부"}[s]||s},formatDate(s){return s?new Date(s).toLocaleDateString("ko-KR"):"-"},formatPreferredDates(s){if(!s)return"-";try{const t=JSON.parse(s);return Array.isArray(t)?t.map(d=>new Date(d).toLocaleDateString("ko-KR")).join(", "):new Date(s).toLocaleDateString("ko-KR")}catch{return s}},async handleLogout(){confirm("로그아웃 하시겠습니까?")&&(await this.authStore.logout(),this.$router.push("/"))}}},D={class:"mypage-container"},x={class:"mypage-card"},A={class:"mypage-header"},w={class:"profile-section"},N={class:"info-grid"},P={class:"info-item"},M={class:"info-item"},R={class:"info-item"},B={class:"info-item"},C={class:"account-section"},I={class:"action-buttons"},F=["disabled"],K={class:"history-section"},V={key:0,class:"empty-state"},j={class:"quick-links"},z={key:1,class:"applications-list"},E={class:"app-header"},T={class:"app-details"},U={class:"detail-item"},q={class:"detail-item"},J={class:"detail-item"};function O(s,t,d,G,r,a){const u=_("router-link");return i(),n("div",D,[e("div",x,[e("div",A,[t[2]||(t[2]=e("h1",null,"마이페이지",-1)),e("p",null,o(a.user?.fullName)+"님의 개인정보를 관리하실 수 있습니다.",1)]),e("div",w,[t[7]||(t[7]=e("h2",null,"프로필 정보",-1)),e("div",N,[e("div",P,[t[3]||(t[3]=e("label",null,"이름",-1)),e("span",null,o(a.user?.fullName||"-"),1)]),e("div",M,[t[4]||(t[4]=e("label",null,"아이디",-1)),e("span",null,o(a.user?.username||"-"),1)]),e("div",R,[t[5]||(t[5]=e("label",null,"이메일",-1)),e("span",null,o(a.user?.email||"-"),1)]),e("div",B,[t[6]||(t[6]=e("label",null,"권한",-1)),e("span",{class:c(["role-badge",a.user?.role])},o(a.getRoleName(a.user?.role)),3)])])]),e("div",C,[t[8]||(t[8]=e("h2",null,"계정 관리",-1)),e("div",I,[e("button",{onClick:t[0]||(t[0]=(...l)=>a.refreshProfile&&a.refreshProfile(...l)),class:"btn btn-primary",disabled:r.isLoading},o(r.isLoading?"새로고침 중...":"프로필 새로고침"),9,F),e("button",{onClick:t[1]||(t[1]=(...l)=>a.handleLogout&&a.handleLogout(...l)),class:"btn btn-secondary"}," 로그아웃 ")])]),e("div",K,[t[16]||(t[16]=e("h2",null,"나의 신청 내역",-1)),r.applications.length===0?(i(),n("div",V,[t[11]||(t[11]=e("p",null,"아직 신청 내역이 없습니다.",-1)),e("div",j,[p(u,{to:"/experience-apply",class:"btn btn-outline"},{default:m(()=>t[9]||(t[9]=[f("승선체험 신청",-1)])),_:1,__:[9]}),p(u,{to:"/exemption-apply",class:"btn btn-outline"},{default:m(()=>t[10]||(t[10]=[f("면제교육 신청",-1)])),_:1,__:[10]})])])):(i(),n("div",z,[(i(!0),n(g,null,y(r.applications,l=>(i(),n("div",{key:l.id,class:"application-item"},[e("div",E,[t[12]||(t[12]=e("h3",null,"면제교육 신청",-1)),e("span",{class:c(["status-badge",l.status])},o(a.getStatusLabel(l.status)),3)]),e("div",T,[e("div",U,[t[13]||(t[13]=e("label",null,"신청일:",-1)),e("span",null,o(a.formatDate(l.created_at)),1)]),e("div",q,[t[14]||(t[14]=e("label",null,"교육과정:",-1)),e("span",null,o(l.education_type==="general"?"면제교육":"실기연수"),1)]),e("div",J,[t[15]||(t[15]=e("label",null,"희망날짜:",-1)),e("span",null,o(a.formatPreferredDates(l.preferred_date)),1)])])]))),128))]))])])])}const Q=h(S,[["render",O],["__scopeId","data-v-d22ed8e2"]]);export{Q as default};
