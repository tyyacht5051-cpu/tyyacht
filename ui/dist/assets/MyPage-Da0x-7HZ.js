import{_ as g,c as o,b as s,k as _,t as n,n as h,C as d,g as y,w as b,h as f,i as k,F as w,e as v,p as A,A as p,l as P,m as C,u as L,f as r}from"./index-B24G-8VQ.js";const S={name:"MyPage",setup(){return{toast:L()}},data(){return{authStore:C,isLoading:!1,exemptionApplications:[],crewPosts:[],crewApplications:[],isLoadingApplications:!1,isLoadingCrewPosts:!1,isUpdatingStatus:!1,showApplicationsModal:!1,selectedPostForApplications:null,errors:{applications:null,crewPosts:null}}},computed:{user(){return this.authStore.state.user}},async mounted(){!this.authStore.state.isAuthenticated&&localStorage.getItem("token")&&this.authStore.init(),this.authStore.state.isAuthenticated&&(await this.loadApplications(),await this.loadCrewPosts())},methods:{getRoleName(i){return{admin:"관리자",user:"일반 사용자"}[i]||"사용자"},async refreshProfile(){this.isLoading=!0;try{await this.authStore.fetchUser()}catch{this.toast.error("프로필 새로고침에 실패했습니다.","⚠️ 프로필 오류")}finally{this.isLoading=!1}},async loadApplications(){this.isLoadingApplications=!0,this.errors.applications=null;try{const i=await this.makeAuthenticatedRequest(`${p}/api/applications/my-exemption`,{method:"GET"});this.exemptionApplications=i.data}catch(i){console.error("Failed to load applications:",i),this.errors.applications="신청 내역을 불러오는데 실패했습니다.",this.toast?.error("신청 내역을 불러오는데 실패했습니다.","⚠️ 로딩 오류")}finally{this.isLoadingApplications=!1}},getStatusLabel(i){return{pending:"승인대기",approved:"승인완료",rejected:"승인거부"}[i]||i},formatDate(i){return this.formatDateUtil(i)},formatDateUtil(i){if(!i)return"-";try{return new Date(i).toLocaleDateString("ko-KR")}catch{return"-"}},formatPreferredDates(i){if(!i)return"-";try{const t=JSON.parse(i);return Array.isArray(t)?t.map(u=>this.formatDateUtil(u)).join(", "):this.formatDateUtil(i)}catch{return i}},async makeAuthenticatedRequest(i,t={}){const u=localStorage.getItem("token");if(!u)throw new Error("인증 토큰이 없습니다.");return P({url:i,headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json",...t.headers},...t})},async loadCrewPosts(){this.isLoadingCrewPosts=!0,this.errors.crewPosts=null;try{const i=await this.makeAuthenticatedRequest(`${p}/api/crews/my/posts`,{method:"GET"});this.crewPosts=i.data}catch(i){console.error("Failed to load crew posts:",i),this.errors.crewPosts="크루 모집글을 불러오는데 실패했습니다.",this.toast?.error("크루 모집글을 불러오는데 실패했습니다.","⚠️ 로딩 오류")}finally{this.isLoadingCrewPosts=!1}},getRecruitmentTypeLabel(i){return{cruise:"크루즈",dinghy:"딩기",general:"일반"}[i]||i},async toggleRecruitmentStatus(i){if(confirm(`정말로 ${i.status==="recruiting"?"모집을 마감":"모집을 재개"}하시겠습니까?`)){this.isUpdatingStatus=!0;try{const t=i.status==="recruiting"?"completed":"recruiting";await this.makeAuthenticatedRequest(`${p}/api/crews/${i.id}/status`,{method:"PATCH",data:{status:t}}),i.status=t,this.toast.success(`모집상태가 ${t==="recruiting"?"모집중":"모집마감"}으로 변경되었습니다.`)}catch(t){console.error("Failed to update status:",t),this.toast.error("상태 변경에 실패했습니다.")}finally{this.isUpdatingStatus=!1}}},editPost(i){this.$router.push(`/crew-recruitment?edit=${i.id}`)},async viewApplications(i){this.selectedPostForApplications=i,this.showApplicationsModal=!0;try{const t=await this.makeAuthenticatedRequest(`${p}/api/crews/my/${i.id}/applications`,{method:"GET"});this.crewApplications=t.data}catch(t){console.error("Failed to load applications:",t),this.toast?.error("신청자 목록을 불러오는데 실패했습니다.","⚠️ 로딩 오류")}},async handleLogout(){confirm("로그아웃 하시겠습니까?")&&(await this.authStore.logout(),this.$router.push("/"))}}},M={class:"mypage-container"},x={class:"mypage-card"},R={class:"mypage-header"},D={class:"profile-section"},K={class:"info-grid"},U={class:"info-item"},F={class:"info-item"},N={class:"info-item"},T={class:"info-item"},q={class:"account-section"},E={class:"action-buttons"},B=["disabled","aria-label"],I={class:"history-section"},V={key:0,class:"loading-state"},j={key:1,class:"error-state"},G={key:2,class:"empty-state"},z={class:"quick-links"},H={key:3,class:"applications-list"},J={class:"app-header"},O={class:"app-details"},Q={class:"detail-item"},W={class:"detail-item"},X={class:"detail-item"},Y={class:"crew-posts-section"},Z={key:0,class:"loading-state"},$={key:1,class:"error-state"},tt={key:2,class:"empty-state"},st={class:"quick-links"},et={key:3,class:"crew-posts-list"},it={class:"post-header"},lt={class:"post-actions"},nt=["onClick","onKeydown","disabled","aria-label"],at=["onClick","onKeydown","aria-label"],ot=["onClick","onKeydown","aria-label"],rt={class:"post-details"},dt={class:"detail-item"},ut={class:"detail-item"},ct={class:"detail-item"},pt={class:"detail-item"},mt={class:"modal-header"},ht={class:"applications-list-modal"},yt={key:0,class:"no-applications"},bt={key:1},ft={class:"applicant-info"},wt={class:"applicant-details"},vt={class:"contact-info"},gt={class:"contact-item"},_t={class:"value"},kt={class:"contact-item"},At={class:"value"};function Pt(i,t,u,Ct,a,l){const m=k("router-link");return r(),o("div",M,[s("div",x,[s("div",R,[t[13]||(t[13]=s("h1",null,"마이페이지",-1)),s("p",null,n(l.user?.fullName)+"님의 개인정보를 관리하실 수 있습니다.",1)]),s("div",D,[t[18]||(t[18]=s("h2",null,"프로필 정보",-1)),s("div",K,[s("div",U,[t[14]||(t[14]=s("label",null,"이름",-1)),s("span",null,n(l.user?.fullName||"-"),1)]),s("div",F,[t[15]||(t[15]=s("label",null,"아이디",-1)),s("span",null,n(l.user?.username||"-"),1)]),s("div",N,[t[16]||(t[16]=s("label",null,"이메일",-1)),s("span",null,n(l.user?.email||"-"),1)]),s("div",T,[t[17]||(t[17]=s("label",null,"권한",-1)),s("span",{class:h(["role-badge",l.user?.role])},n(l.getRoleName(l.user?.role)),3)])])]),s("div",q,[t[19]||(t[19]=s("h2",null,"계정 관리",-1)),s("div",E,[s("button",{onClick:t[0]||(t[0]=(...e)=>l.refreshProfile&&l.refreshProfile(...e)),onKeydown:t[1]||(t[1]=d((...e)=>l.refreshProfile&&l.refreshProfile(...e),["enter"])),class:"btn btn-primary",disabled:a.isLoading,"aria-label":a.isLoading?"프로필 새로고침 중":"프로필 새로고침"},n(a.isLoading?"새로고침 중...":"프로필 새로고침"),41,B),s("button",{onClick:t[2]||(t[2]=(...e)=>l.handleLogout&&l.handleLogout(...e)),onKeydown:t[3]||(t[3]=d((...e)=>l.handleLogout&&l.handleLogout(...e),["enter"])),class:"btn btn-secondary","aria-label":"로그아웃"}," 로그아웃 ",32)])]),s("div",I,[t[28]||(t[28]=s("h2",null,"나의 신청 내역",-1)),a.isLoadingApplications?(r(),o("div",V,t[20]||(t[20]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"신청 내역을 불러오는 중...",-1)]))):a.errors.applications?(r(),o("div",j,[s("p",null,n(a.errors.applications),1),s("button",{onClick:t[4]||(t[4]=(...e)=>l.loadApplications&&l.loadApplications(...e)),onKeydown:t[5]||(t[5]=d((...e)=>l.loadApplications&&l.loadApplications(...e),["enter"])),class:"btn btn-outline retry-btn","aria-label":"신청 내역 다시 불러오기"},"다시 시도",32)])):a.exemptionApplications.length===0?(r(),o("div",G,[t[23]||(t[23]=s("p",null,"아직 신청 내역이 없습니다.",-1)),s("div",z,[y(m,{to:"/experience-apply",class:"btn btn-outline"},{default:b(()=>t[21]||(t[21]=[f("승선체험 신청",-1)])),_:1,__:[21]}),y(m,{to:"/exemption-apply",class:"btn btn-outline"},{default:b(()=>t[22]||(t[22]=[f("면제교육 신청",-1)])),_:1,__:[22]})])])):(r(),o("div",H,[(r(!0),o(w,null,v(a.exemptionApplications,e=>(r(),o("div",{key:e.id,class:"application-item"},[s("div",J,[t[24]||(t[24]=s("h3",null,"면제교육 신청",-1)),s("span",{class:h(["status-badge",e.status])},n(l.getStatusLabel(e.status)),3)]),s("div",O,[s("div",Q,[t[25]||(t[25]=s("label",null,"신청일:",-1)),s("span",null,n(l.formatDate(e.created_at)),1)]),s("div",W,[t[26]||(t[26]=s("label",null,"교육과정:",-1)),s("span",null,n(e.education_type==="general"?"면제교육":"실기연수"),1)]),s("div",X,[t[27]||(t[27]=s("label",null,"희망날짜:",-1)),s("span",null,n(l.formatPreferredDates(e.preferred_date)),1)])])]))),128))]))]),s("div",Y,[t[36]||(t[36]=s("h2",null,"내가 작성한 크루 모집글",-1)),a.isLoadingCrewPosts?(r(),o("div",Z,t[29]||(t[29]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"크루 모집글을 불러오는 중...",-1)]))):a.errors.crewPosts?(r(),o("div",$,[s("p",null,n(a.errors.crewPosts),1),s("button",{onClick:t[6]||(t[6]=(...e)=>l.loadCrewPosts&&l.loadCrewPosts(...e)),onKeydown:t[7]||(t[7]=d((...e)=>l.loadCrewPosts&&l.loadCrewPosts(...e),["enter"])),class:"btn btn-outline retry-btn","aria-label":"크루 모집글 다시 불러오기"},"다시 시도",32)])):a.crewPosts.length===0?(r(),o("div",tt,[t[31]||(t[31]=s("p",null,"작성한 크루 모집글이 없습니다.",-1)),s("div",st,[y(m,{to:"/crew-recruitment",class:"btn btn-outline"},{default:b(()=>t[30]||(t[30]=[f("크루 모집글 작성",-1)])),_:1,__:[30]})])])):(r(),o("div",et,[(r(!0),o(w,null,v(a.crewPosts,e=>(r(),o("div",{key:e.id,class:"crew-post-item"},[s("div",it,[s("h3",null,n(e.title),1),s("div",lt,[s("span",{class:h(["status-badge",e.status])},n(e.status==="recruiting"?"모집중":"모집마감"),3),s("button",{onClick:c=>l.toggleRecruitmentStatus(e),onKeydown:d(c=>l.toggleRecruitmentStatus(e),["enter"]),class:"btn btn-sm btn-outline",disabled:a.isUpdatingStatus,"aria-label":`${e.title} 모집상태 ${e.status==="recruiting"?"마감":"재개"}`},n(e.status==="recruiting"?"모집마감":"모집재개"),41,nt),s("button",{onClick:c=>l.editPost(e),onKeydown:d(c=>l.editPost(e),["enter"]),class:"btn btn-sm btn-primary","aria-label":`${e.title} 수정`}," 수정 ",40,at),s("button",{onClick:c=>l.viewApplications(e),onKeydown:d(c=>l.viewApplications(e),["enter"]),class:"btn btn-sm btn-outline","aria-label":`${e.title} 신청자 보기`}," 신청자 보기 ",40,ot)])]),s("div",rt,[s("div",dt,[t[32]||(t[32]=s("label",null,"모집유형:",-1)),s("span",null,n(l.getRecruitmentTypeLabel(e.recruitment_type)),1)]),s("div",ut,[t[33]||(t[33]=s("label",null,"모집인원:",-1)),s("span",null,n(e.current_crew)+"/"+n(e.max_crew)+"명",1)]),s("div",ct,[t[34]||(t[34]=s("label",null,"작성일:",-1)),s("span",null,n(l.formatDate(e.created_at)),1)]),s("div",pt,[t[35]||(t[35]=s("label",null,"조회수:",-1)),s("span",null,n(e.views)+"회",1)])])]))),128))]))]),a.showApplicationsModal?(r(),o("div",{key:0,class:"modal",onClick:t[12]||(t[12]=e=>a.showApplicationsModal=!1)},[s("div",{class:"modal-content",onClick:t[11]||(t[11]=A(()=>{},["stop"]))},[s("div",mt,[s("h3",null,n(a.selectedPostForApplications?.title)+" - 신청자 목록",1),s("button",{class:"close-btn",onClick:t[8]||(t[8]=e=>a.showApplicationsModal=!1),onKeydown:[t[9]||(t[9]=d(e=>a.showApplicationsModal=!1,["enter"])),t[10]||(t[10]=d(e=>a.showApplicationsModal=!1,["escape"]))],"aria-label":"모달 닫기"},"×",32)]),s("div",ht,[a.crewApplications.length===0?(r(),o("div",yt,t[37]||(t[37]=[s("p",null,"아직 신청자가 없습니다.",-1)]))):(r(),o("div",bt,[(r(!0),o(w,null,v(a.crewApplications,e=>(r(),o("div",{key:e.id,class:"application-item-modal"},[s("div",ft,[s("div",wt,[s("h4",null,n(e.name),1)]),s("div",vt,[s("div",gt,[t[38]||(t[38]=s("span",{class:"label"},"연락처:",-1)),s("span",_t,n(e.phone||"-"),1)]),s("div",kt,[t[39]||(t[39]=s("span",{class:"label"},"신청일:",-1)),s("span",At,n(l.formatDate(e.applied_at)),1)])])])]))),128))]))])])])):_("",!0)])])}const St=g(S,[["render",Pt],["__scopeId","data-v-a55ee4e0"]]);export{St as default};
