import{_ as M,c as l,a as N,b as t,k as u,g as y,w as b,h as C,i as S,t as r,q as h,s as B,v,C as F,F as w,e as f,n as k,p as I,l as _,A as g,m as A,u as x,f as n}from"./index-B24G-8VQ.js";const D={name:"NoticeCruise",setup(){return{toast:x()}},data(){return{authStore:A,showWriteForm:!1,searchType:"title",searchKeyword:"",newNotice:{title:"",content:"",images:[]},selectedImages:[],selectedNotice:null,imageModal:{show:!1,image:null},notices:[],API_BASE_URL:g}},async mounted(){await this.loadNotices()},computed:{isAdmin(){return this.authStore.state.isAuthenticated&&this.authStore.state.user?.role==="admin"},filteredNotices(){return this.searchKeyword?this.notices.filter(o=>{switch(this.searchType){case"title":return o.title.includes(this.searchKeyword);case"content":return o.content.includes(this.searchKeyword);case"all":return o.title.includes(this.searchKeyword)||o.content.includes(this.searchKeyword);default:return!0}}):this.notices},paginatedNotices(){return this.filteredNotices}},methods:{viewNotice(o){o.views++,this.selectedNotice=o},openWriteForm(){this.showWriteForm=!0},searchNotices(){},async loadNotices(){try{const o=await _.get(`${g}/api/notices`,{params:{category:"cruise",limit:100}});this.notices=o.data.map(e=>({...e,date:e.created_at.split("T")[0]}))}catch(o){console.error("í¬ë£¨ì¦ˆìš”íŠ¸ ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨:",o),this.toast.error("ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","âš ï¸ ë¡œë“œ ì˜¤ë¥˜")}},async createNewPage(){try{const e=(await _.post(`${g}/api/notices/draft`,{category_id:"cruise",title:"ìƒˆ ê³µì§€ì‚¬í•­",content:"ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."},{headers:{Authorization:`Bearer ${this.authStore.state.token}`}})).data.id;this.$router.push(`/notice/cruise/edit/${e}`)}catch(o){console.error("ìƒˆ í˜ì´ì§€ ìƒì„± ì‹¤íŒ¨:",o),o.response?.status===401?(this.toast.urgent("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.","ğŸ” ë¡œê·¸ì¸ í•„ìš”"),this.$router.push("/login")):o.response?.status===403?this.toast.urgent("ê´€ë¦¬ìë§Œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.","âš ï¸ ê¶Œí•œ ì—†ìŒ"):this.toast.error("ìƒˆ í˜ì´ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","âŒ ìƒì„± ì‹¤íŒ¨")}},handleImageSelection(o){const e=Array.from(o.target.files),c=3,d=5*1024*1024;if(this.selectedImages.length+e.length>c){alert(`ìµœëŒ€ ${c}ê°œì˜ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);return}e.forEach(i=>{if(i.size>d){alert(`${i.name} íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 5MB)`);return}if(!i.type.startsWith("image/")){alert(`${i.name}ì€ ì´ë¯¸ì§€ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.`);return}const a=new FileReader;a.onload=m=>{this.selectedImages.push({file:i,name:i.name,size:i.size,preview:m.target.result})},a.readAsDataURL(i)})},removeImage(o){this.selectedImages.splice(o,1)},formatFileSize(o){if(o===0)return"0 Bytes";const e=1024,c=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,d)).toFixed(2))+" "+c[d]},async submitNotice(){if(!this.newNotice.title||!this.newNotice.content){this.toast.warning("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.","âœï¸ ì…ë ¥ í™•ì¸");return}try{const o=new FormData;o.append("title",this.newNotice.title),o.append("content",this.newNotice.content),o.append("category_id","cruise"),o.append("important","false"),this.selectedImages.forEach(c=>{o.append("images",c.file)});const e=await _.post(`${g}/api/notices`,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.authStore.state.token}`}});this.showWriteForm=!1,this.newNotice={title:"",content:"",images:[]},this.selectedImages=[],this.$refs.imageInput&&(this.$refs.imageInput.value=""),await this.loadNotices(),this.toast.success("ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.","ë“±ë¡ ì™„ë£Œ")}catch(o){console.error("ê³µì§€ì‚¬í•­ ë“±ë¡ ì‹¤íŒ¨:",o),o.response?.status===401?(this.toast.urgent("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.","ğŸ” ë¡œê·¸ì¸ í•„ìš”"),this.$router.push("/login")):o.response?.status===403?this.toast.urgent("ê´€ë¦¬ìë§Œ ê³µì§€ì‚¬í•­ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.","âš ï¸ ê¶Œí•œ ì—†ìŒ"):this.toast.error("ê³µì§€ì‚¬í•­ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","âŒ ë“±ë¡ ì‹¤íŒ¨")}},formatDate(o){const e=new Date(o),d=Math.floor((new Date-e)/(1e3*60*60*24));return d===0?"ì˜¤ëŠ˜":d===1?"ì–´ì œ":e.toLocaleDateString("ko-KR")},isNewNotice(o){return Math.floor((new Date-new Date(o))/(1e3*60*60*24))<=3},goBack(){this.$router.push("/notice")},openImageModal(o){this.imageModal.show=!0,this.imageModal.image=o},closeImageModal(){this.imageModal.show=!1,this.imageModal.image=null}}},z={class:"notice-cruise"},K={class:"content-section"},T={class:"container"},V={class:"notice-header"},W={class:"breadcrumb"},U={class:"notice-info"},E={class:"total-count"},P={class:"search-section"},L={class:"search-controls"},R={key:0,class:"admin-controls"},q={class:"notices-table"},G={class:"col-number"},j={class:"col-title"},H={key:0,class:"new-badge"},J={class:"col-date"},O={class:"col-views"},Q={key:0,class:"write-form"},X={class:"form-header"},Y={class:"form-group"},Z={class:"form-group"},$={class:"form-group"},ee={class:"image-upload-container"},te={key:0,class:"image-preview-container"},se=["src","alt"],oe={class:"image-info"},ie={class:"image-name"},ae={class:"image-size"},le=["onClick"],ne={class:"form-actions"},re={key:1,class:"notice-detail"},ce={class:"detail-header"},de={class:"detail-meta"},ue={key:0,class:"important-badge"},me={class:"detail-content"},he={class:"content-text"},ge={key:0,class:"content-images"},pe={class:"images-gallery"},ve=["src","alt","onClick"],we={class:"back-button"},fe=["src","alt"],_e={class:"modal-info"};function Ne(o,e,c,d,i,a){const m=S("router-link");return n(),l("div",z,[e[27]||(e[27]=N('<section class="hero-section" data-v-5524564c><div class="hero-background" data-v-5524564c></div><div class="hero-overlay" data-v-5524564c></div><div class="hero-content" data-v-5524564c><h1 class="hero-title" data-v-5524564c>í¬ë£¨ì¦ˆìš”íŠ¸ ê³µì§€ì‚¬í•­</h1><p class="hero-subtitle" data-v-5524564c>í¬ë£¨ì¦ˆìš”íŠ¸ êµìœ¡ ë° ì²´í—˜ ê´€ë ¨ ê³µì§€ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”</p></div></section>',1)),t("section",K,[t("div",T,[t("div",V,[t("div",W,[y(m,{to:"/notice"},{default:b(()=>e[16]||(e[16]=[C("ê³µì§€ì‚¬í•­",-1)])),_:1,__:[16]}),e[17]||(e[17]=t("span",{class:"separator"},">",-1)),e[18]||(e[18]=t("span",{class:"current"},"í¬ë£¨ì¦ˆìš”íŠ¸",-1))]),t("div",U,[t("span",E,"ì´ "+r(a.filteredNotices.length)+"ê°œ ê²Œì‹œë¬¼",1)])]),t("div",P,[t("div",L,[h(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.searchType=s),class:"search-select"},e[19]||(e[19]=[t("option",{value:"title"},"ì œëª©",-1),t("option",{value:"content"},"ë‚´ìš©",-1),t("option",{value:"all"},"ì „ì²´",-1)]),512),[[B,i.searchType]]),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.searchKeyword=s),type:"text",placeholder:"ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”",class:"search-input",onKeyup:e[2]||(e[2]=F((...s)=>a.searchNotices&&a.searchNotices(...s),["enter"]))},null,544),[[v,i.searchKeyword]]),t("button",{onClick:e[3]||(e[3]=(...s)=>a.searchNotices&&a.searchNotices(...s)),class:"search-btn"},"ê²€ìƒ‰")]),a.isAdmin?(n(),l("div",R,[t("button",{onClick:e[4]||(e[4]=(...s)=>a.createNewPage&&a.createNewPage(...s)),class:"write-btn"},"âœï¸ ê¸€ì“°ê¸°")])):u("",!0)]),t("div",q,[e[20]||(e[20]=N('<div class="table-header" data-v-5524564c><div class="col-number" data-v-5524564c>ë²ˆí˜¸</div><div class="col-title" data-v-5524564c>ì œëª©</div><div class="col-date" data-v-5524564c>ì‘ì„±ì¼</div><div class="col-views" data-v-5524564c>ì¡°íšŒ</div></div>',1)),(n(!0),l(w,null,f(a.paginatedNotices,s=>(n(),l("div",{key:s.id,class:k(["table-row",{"important-row":s.important}])},[t("div",G,r(s.id),1),t("div",j,[y(m,{to:`/notice/cruise/${s.id}`,class:"title-link"},{default:b(()=>[t("span",{class:k(["title-text",{"important-title":s.important}])},r(s.title),3),a.isNewNotice(s.date)?(n(),l("span",H,"NEW")):u("",!0)]),_:2},1032,["to"])]),t("div",J,r(a.formatDate(s.date)),1),t("div",O,r(s.views),1)],2))),128))]),i.showWriteForm&&a.isAdmin?(n(),l("div",Q,[t("div",X,[e[21]||(e[21]=t("h3",null,"í¬ë£¨ì¦ˆìš”íŠ¸ ê³µì§€ì‚¬í•­ ì‘ì„±",-1)),t("button",{class:"close-btn",onClick:e[5]||(e[5]=s=>i.showWriteForm=!1)},"âœ•")]),t("form",{onSubmit:e[10]||(e[10]=I((...s)=>a.submitNotice&&a.submitNotice(...s),["prevent"]))},[t("div",Y,[e[22]||(e[22]=t("label",null,"ì œëª©",-1)),h(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>i.newNotice.title=s),type:"text",required:""},null,512),[[v,i.newNotice.title]])]),t("div",Z,[e[23]||(e[23]=t("label",null,"ë‚´ìš©",-1)),h(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>i.newNotice.content=s),rows:"10",required:""},null,512),[[v,i.newNotice.content]])]),t("div",$,[e[25]||(e[25]=t("label",null,"ì´ë¯¸ì§€ ì²¨ë¶€ (ìµœëŒ€ 3ê°œ, ê°ê° 5MB ì´í•˜)",-1)),t("div",ee,[t("input",{type:"file",ref:"imageInput",onChange:e[8]||(e[8]=(...s)=>a.handleImageSelection&&a.handleImageSelection(...s)),accept:"image/*",multiple:"",class:"image-input",id:"image-upload"},null,544),e[24]||(e[24]=t("label",{for:"image-upload",class:"upload-btn"}," ğŸ“· ì´ë¯¸ì§€ ì„ íƒ ",-1)),i.selectedImages.length>0?(n(),l("div",te,[(n(!0),l(w,null,f(i.selectedImages,(s,p)=>(n(),l("div",{key:p,class:"image-preview"},[t("img",{src:s.preview,alt:s.name},null,8,se),t("div",oe,[t("span",ie,r(s.name),1),t("span",ae,"("+r(a.formatFileSize(s.size))+")",1)]),t("button",{type:"button",class:"remove-image-btn",onClick:ye=>a.removeImage(p)},"âœ•",8,le)]))),128))])):u("",!0)])]),t("div",ne,[t("button",{type:"button",class:"cancel-btn",onClick:e[9]||(e[9]=s=>i.showWriteForm=!1)},"ì·¨ì†Œ"),e[26]||(e[26]=t("button",{type:"submit",class:"submit-btn"},"ë“±ë¡",-1))])],32)])):u("",!0),i.selectedNotice?(n(),l("div",re,[t("div",ce,[t("h3",null,r(i.selectedNotice.title),1),t("button",{class:"close-btn",onClick:e[11]||(e[11]=s=>i.selectedNotice=null)},"âœ•")]),t("div",de,[t("span",null,"ì‘ì„±ì¼: "+r(a.formatDate(i.selectedNotice.date)),1),t("span",null,"ì¡°íšŒìˆ˜: "+r(i.selectedNotice.views),1),i.selectedNotice.important?(n(),l("span",ue,"ì¤‘ìš”")):u("",!0)]),t("div",me,[t("div",he,r(i.selectedNotice.content),1),i.selectedNotice.images&&i.selectedNotice.images.length>0?(n(),l("div",ge,[t("div",pe,[(n(!0),l(w,null,f(i.selectedNotice.images,s=>(n(),l("div",{key:s.id,class:"image-item"},[t("img",{src:`${i.API_BASE_URL}${s.url}`,alt:s.original_name,onClick:p=>a.openImageModal(s)},null,8,ve)]))),128))])])):u("",!0)])])):u("",!0)])]),t("div",we,[t("button",{onClick:e[12]||(e[12]=(...s)=>a.goBack&&a.goBack(...s)),class:"back-btn"},"â† ê³µì§€ì‚¬í•­ìœ¼ë¡œ ëŒì•„ê°€ê¸°")]),i.imageModal.show?(n(),l("div",{key:0,class:"image-modal",onClick:e[15]||(e[15]=(...s)=>a.closeImageModal&&a.closeImageModal(...s))},[t("div",{class:"modal-content",onClick:e[14]||(e[14]=I(()=>{},["stop"]))},[t("button",{class:"modal-close",onClick:e[13]||(e[13]=(...s)=>a.closeImageModal&&a.closeImageModal(...s))},"âœ•"),t("img",{src:`${i.API_BASE_URL}${i.imageModal.image.url}`,alt:i.imageModal.image.original_name},null,8,fe),t("div",_e,[t("p",null,r(i.imageModal.image.original_name),1)])])])):u("",!0)])}const ke=M(D,[["render",Ne],["__scopeId","data-v-5524564c"]]);export{ke as default};
