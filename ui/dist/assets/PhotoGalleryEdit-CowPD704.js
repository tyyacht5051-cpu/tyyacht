import{_ as k,c as r,a as v,b as e,t as c,k as y,q as p,v as m,s as S,F as f,e as _,l as g,A as u,m as P,u as B,f as n}from"./index-B24G-8VQ.js";const w={name:"PhotoGalleryEdit",setup(){return{toast:B()}},data(){return{authStore:P,API_BASE_URL:u,galleryId:null,isSaving:!1,gallery:{title:"",description:"",category_id:"",photos:[]},selectedPhotos:[]}},async mounted(){if(this.galleryId=parseInt(this.$route.params.id),!this.authStore.state.isAuthenticated||this.authStore.state.user?.role!=="admin"){this.toast.urgent("ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.","âš ï¸ ê¶Œí•œ ì—†ìŒ"),this.$router.push("/community/photo-gallery");return}await this.loadGallery()},methods:{async loadGallery(){try{const o=await g.get(`${u}/api/photos/${this.galleryId}`);this.gallery={title:o.data.title,description:o.data.description,category_id:o.data.category_id,photos:o.data.photos||[]}}catch(o){console.error("ê°¤ëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨:",o),this.toast.error("ê°¤ëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","âŒ ë¡œë“œ ì‹¤íŒ¨"),this.$router.push("/community/photo-gallery")}},handlePhotoSelection(o){const t=Array.from(o.target.files);if(t.length+this.selectedPhotos.length+this.gallery.photos.length>20){this.toast.error("ìµœëŒ€ 20ì¥ê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.","âš ï¸ ì œí•œ ì´ˆê³¼");return}t.forEach(a=>{if(a.size>100*1024*1024){this.toast.error(`${a.name}ì€(ëŠ”) 100MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`,"âš ï¸ íŒŒì¼ í¬ê¸° ì´ˆê³¼");return}const d=new FileReader;d.onload=l=>{this.selectedPhotos.push({file:a,preview:l.target.result})},d.readAsDataURL(a)}),o.target.value=""},removeNewPhoto(o){this.selectedPhotos.splice(o,1)},async deletePhoto(o){if(confirm("ì´ ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await g.delete(`${u}/api/photos/${this.galleryId}/photos/${o}`,{headers:{Authorization:`Bearer ${this.authStore.state.token}`}}),this.gallery.photos=this.gallery.photos.filter(t=>t.id!==o),this.toast.success("ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.","ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ")}catch(t){console.error("ì‚¬ì§„ ì‚­ì œ ì‹¤íŒ¨:",t),this.toast.error("ì‚¬ì§„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","âŒ ì‚­ì œ ì‹¤íŒ¨")}},async saveGallery(){if(!this.gallery.title||!this.gallery.category_id){this.toast.error("ì œëª©ê³¼ ì¹´í…Œê³ ë¦¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.","âš ï¸ ì…ë ¥ ì˜¤ë¥˜");return}this.isSaving=!0;try{const o=new FormData;o.append("title",this.gallery.title),o.append("description",this.gallery.description||""),o.append("category_id",this.gallery.category_id),this.selectedPhotos.forEach(t=>{o.append("photos",t.file)}),await g.put(`${u}/api/photos/${this.galleryId}`,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${this.authStore.state.token}`}}),this.toast.success("ê°¤ëŸ¬ë¦¬ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.","ğŸ’¾ ì €ì¥ ì™„ë£Œ"),this.$router.push("/community/photo-gallery")}catch(o){console.error("ê°¤ëŸ¬ë¦¬ ì €ì¥ ì‹¤íŒ¨:",o),this.toast.error("ê°¤ëŸ¬ë¦¬ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","âŒ ì €ì¥ ì‹¤íŒ¨")}finally{this.isSaving=!1}},cancel(){confirm("ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ì§€ ì•Šê³  ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")&&this.$router.push("/community/photo-gallery")},goBack(){this.cancel()},formatFileSize(o){if(o===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,d)).toFixed(2))+" "+a[d]}}},x={class:"photo-gallery-edit"},A={class:"content-section"},C={class:"container"},z={class:"edit-form"},F={class:"form-header"},I={class:"header-buttons"},G=["disabled"],M={class:"form-body"},E={class:"form-group"},U={class:"form-group"},V={class:"form-group"},D={key:0,class:"existing-photos"},N={class:"photos-grid"},L=["src","alt"],R={class:"photo-overlay"},q=["onClick"],T={class:"photo-info-small"},K={class:"form-group"},j={key:1,class:"selected-photos"},H={class:"photos-grid"},J=["src","alt"],O={class:"photo-overlay"},Q=["onClick"],W={class:"photo-info-small"},X={class:"back-button"};function Y(o,t,a,d,l,i){return n(),r("div",x,[t[14]||(t[14]=v('<section class="hero-section" data-v-5eb97025><div class="hero-background" data-v-5eb97025></div><div class="hero-overlay" data-v-5eb97025></div><div class="hero-content" data-v-5eb97025><h1 class="hero-title" data-v-5eb97025>í¬í† ê°¤ëŸ¬ë¦¬ í¸ì§‘</h1><p class="hero-subtitle" data-v-5eb97025>ê°¤ëŸ¬ë¦¬ ì •ë³´ ë° ì‚¬ì§„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p></div></section>',1)),e("section",A,[e("div",C,[e("div",z,[e("div",F,[t[7]||(t[7]=e("h2",null,"ê°¤ëŸ¬ë¦¬ í¸ì§‘",-1)),e("div",I,[e("button",{onClick:t[0]||(t[0]=(...s)=>i.saveGallery&&i.saveGallery(...s)),class:"save-btn",disabled:l.isSaving}," ğŸ’¾ "+c(l.isSaving?"ì €ì¥ ì¤‘...":"ì €ì¥"),9,G),e("button",{onClick:t[1]||(t[1]=(...s)=>i.cancel&&i.cancel(...s)),class:"cancel-btn"},"ì·¨ì†Œ")])]),e("div",M,[e("div",E,[t[8]||(t[8]=e("label",null,"ì œëª© *",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.gallery.title=s),type:"text",required:"",placeholder:"ê°¤ëŸ¬ë¦¬ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"},null,512),[[m,l.gallery.title]])]),e("div",U,[t[9]||(t[9]=e("label",null,"ì„¤ëª…",-1)),p(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.gallery.description=s),rows:"4",placeholder:"ê°¤ëŸ¬ë¦¬ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"},null,512),[[m,l.gallery.description]])]),e("div",V,[t[11]||(t[11]=e("label",null,"ì¹´í…Œê³ ë¦¬ *",-1)),p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.gallery.category_id=s),required:""},t[10]||(t[10]=[v('<option value="" data-v-5eb97025>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option><option value="cruise-education" data-v-5eb97025>í¬ë£¨ì¦ˆ ìš”íŠ¸ êµìœ¡</option><option value="cruise-experience" data-v-5eb97025>í¬ë£¨ì¦ˆ ìš”íŠ¸ ì²´í—˜</option><option value="dinghy-education" data-v-5eb97025>ë”©ê¸° ìš”íŠ¸ êµìœ¡</option><option value="dinghy-experience" data-v-5eb97025>ë”©ê¸° ìš”íŠ¸ ì²´í—˜</option><option value="exemption-education" data-v-5eb97025>ë©´ì œêµìœ¡</option><option value="paddleboard" data-v-5eb97025>íŒ¨ë“¤ë³´ë“œ</option><option value="events" data-v-5eb97025>ì´ë²¤íŠ¸</option><option value="others" data-v-5eb97025>ê¸°íƒ€</option>',9)]),512),[[S,l.gallery.category_id]])]),l.gallery.photos&&l.gallery.photos.length>0?(n(),r("div",D,[e("h3",null,"ê¸°ì¡´ ì‚¬ì§„ ("+c(l.gallery.photos.length)+"ì¥)",1),e("div",N,[(n(!0),r(f,null,_(l.gallery.photos,(s,h)=>(n(),r("div",{key:s.id,class:"photo-item"},[e("img",{src:`${l.API_BASE_URL}${s.url}`,alt:`ì‚¬ì§„ ${h+1}`},null,8,L),e("div",R,[e("button",{onClick:b=>i.deletePhoto(s.id),class:"delete-photo-btn",title:"ì‚¬ì§„ ì‚­ì œ"}," ğŸ—‘ï¸ ",8,q)]),e("div",T,c(i.formatFileSize(s.file_size)),1)]))),128))])])):y("",!0),e("div",K,[t[12]||(t[12]=e("label",null,"ìƒˆ ì‚¬ì§„ ì¶”ê°€ (ìµœëŒ€ 20ì¥)",-1)),e("input",{type:"file",ref:"photoInput",onChange:t[5]||(t[5]=(...s)=>i.handlePhotoSelection&&i.handlePhotoSelection(...s)),accept:"image/*",multiple:"",class:"file-input"},null,544),t[13]||(t[13]=e("label",{for:"photo-upload",class:"upload-label"}," ğŸ“· ì‚¬ì§„ ì„ íƒ ",-1))]),l.selectedPhotos.length>0?(n(),r("div",j,[e("h3",null,"ìƒˆë¡œ ì¶”ê°€í•  ì‚¬ì§„ ("+c(l.selectedPhotos.length)+"ì¥)",1),e("div",H,[(n(!0),r(f,null,_(l.selectedPhotos,(s,h)=>(n(),r("div",{key:h,class:"photo-item"},[e("img",{src:s.preview,alt:`ìƒˆ ì‚¬ì§„ ${h+1}`},null,8,J),e("div",O,[e("button",{onClick:b=>i.removeNewPhoto(h),class:"delete-photo-btn",title:"ì œê±°"}," âœ• ",8,Q)]),e("div",W,c(i.formatFileSize(s.file.size)),1)]))),128))])])):y("",!0)])])])]),e("div",X,[e("button",{onClick:t[6]||(t[6]=(...s)=>i.goBack&&i.goBack(...s)),class:"back-btn"}," â† ê°¤ëŸ¬ë¦¬ë¡œ ëŒì•„ê°€ê¸° ")])])}const $=k(w,[["render",Y],["__scopeId","data-v-5eb97025"]]);export{$ as default};
